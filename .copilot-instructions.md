# 🧩 ROMISH.GG — Copilot Instruction File

You are assisting in the development of **Romish.gg**, a full-stack CS2 10-man matchmaking system.

---

## 🧱 TECH STACK

- **Frontend:** Vue 3 + Pinia + Axios + Socket.IO + Vite
- **Backend:** Node.js + Express + MongoDB (Mongoose)
- **Auth:** JWT with HTTP-only cookies (30-day rolling expiration)
- **Testing:** Jest (backend), Cypress (frontend)
- **Infrastructure:** Dathost API (server creation), Discord bot (verification), Steam OAuth (login)

---

## ⚙️ CORE OBJECTIVE

Keep the platform fully functional and consistent across these major flows:

1. **Login / Signup**
2. **Queue System**
3. **Accept Phase**
4. **Captain Draft**
5. **Map Veto**
6. **Match Lobby**
7. **Global Chat**
8. **Profile + Admin Panel**

---

## 🔐 AUTHENTICATION RULES

- Always store JWTs as **HTTP-only cookies**.
- Cookies should **refresh every visit** and expire only after **30 days of inactivity**.
- Axios requests **must include `withCredentials: true`**.
- Backend routes (`/queue`, `/ready`, `/draft`, `/veto`, `/lobby`) must all use this middleware:

```js
const verifyToken = (req, res, next) => {
  const token = req.cookies?.token;
  if (!token) return res.status(401).json({ message: 'Unauthorized' });
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch {
    return res.status(403).json({ message: 'Invalid token' });
  }
};
Add /auth/refresh to reissue valid tokens on revisit.

🎮 QUEUE + ACCEPT PHASE
Queue requires authentication; unauthorized users cannot join.

When 10 players join, automatically trigger the accept phase.

Each player must click Accept within 60 seconds:

All accept → move to captain draft.

One or more decline/time out → return all to queue.

Broadcast live accept states through WebSocket (Socket.IO).

Add global 60-second timeout and reset on failure.

💬 GLOBAL CHAT
Implement chatMessage Socket.IO event.

Show messages on all pages for logged-in users.

Save last 50 messages in MongoDB or Redis.

Include username, avatar, and timestamp.

🧪 TESTING GUIDELINES
Backend (Jest)
Use supertest for API route tests (/auth, /queue, /ready).

Mock JWT + MongoDB interactions.

Test WebSocket accept logic (with mock timers).

Frontend (Cypress)
E2E test: login → queue → accept → draft → veto → lobby.

Mock WebSocket events for automated testing.

Ensure cookies persist across refreshes.

⚙️ DEVELOPMENT BEHAVIOR
Copilot should:

Prioritize stability over new features.

Avoid rewriting working logic unless fixing a confirmed bug.

Suggest complete functions/modules, not partial snippets.

Follow modular MVC structure for backend and composable structure for frontend.

Use async/await consistently.

Use ESLint + Prettier style.

Optimize for readability and maintainability (not brevity).

🧼 CLEANUP / OPTIMIZATION
Remove redundant auth handlers or Axios interceptors.

Use socket.join(matchId) for per-match communication.

Ensure 0 console errors or CORS warnings.

Maintain clean console outputs on both ends.

🔒 SECURITY & PERFORMANCE
Never expose JWTs client-side.

Handle CORS for http://localhost:5173 and production domain.

Use compression + helmet in Express.

Optimize DB queries with .lean() and proper indexes.

🎯 END GOAL
After every Copilot-assisted commit:

Login & cookies work across refreshes and pages.

Queue → Accept → Draft → Veto → Lobby works without manual refresh.

Global chat works.

Jest + Cypress tests pass.

No breaking changes to WebSocket or Dathost integration.
```
